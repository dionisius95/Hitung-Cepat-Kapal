<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hitung Cepat CPO Kapal</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f6f6f6; }
  h2 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  th { background: #e8e8e8; }
  input { width: 90%; padding: 4px; text-align: right; }
  button { margin-top: 10px; padding: 6px 12px; cursor: pointer; }
  .summary { margin-top: 20px; background: #fff; padding: 10px; border: 1px solid #ccc; }
</style>
</head>
<body>

<h2>Hitung Cepat CPO Kapal</h2>

<table id="dataTable">
  <thead>
    <tr>
      <th>Palka</th>
      <th>Sounding</th>
      <th>V1</th>
      <th>V2</th>
      <th>Suhu (°C)</th>
      <th>BJ</th>
      <th>Tonase tanpa BJ</th>
      <th>Tonase BJ</th>
      <th></th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<button onclick="tambahBaris()">➕ Tambah Palka</button>

<div class="summary">
  <p><b>Total S/F:</b> <span id="totalSF">0</span></p>
  <p><b>B/L:</b> <input type="number" id="blInput" oninput="hitungDiff()"> </p>
  <p><b>DIFF:</b> <span id="diff">0</span></p>
  <p><b>%DIFF:</b> <span id="percentDiff">0</span>%</p>
</div>

<script>
// ===== Data BJ asli dari Excel =====
const densitas = {
25:0.9066,26:0.9060,27:0.9053,28:0.9047,29:0.9040,30:0.9034,31:0.9028,32:0.9021,
33:0.9015,34:0.9008,35:0.9002,36:0.8995,37:0.8989,38:0.8982,39:0.8975,40:0.8970,
41:0.8963,42:0.8957,43:0.8950,44:0.8944,45:0.8938,46:0.8931,47:0.8925,48:0.8919,
49:0.8912,50:0.8906,51:0.8900,52:0.8893,53:0.8887,54:0.8881,55:0.8874,56:0.8868,
57:0.8862,58:0.8855,59:0.8849,60:0.8843,61:0.8836,62:0.8830,63:0.8823,64:0.8817,
65:0.8810,66:0.8804,67:0.8793,68:0.8787,69:0.8780,70:0.8774,71:0.8767,72:0.8761,
73:0.8754,74:0.8748,75:0.8742,76:0.8735,77:0.8729,78:0.8722,79:0.8712,80:0.8705
};

// ===== Tambah Baris =====
function tambahBaris() {
  const tbody = document.getElementById("tableBody");
  const row = document.createElement("tr");
  row.innerHTML = `
    <td><input type="text" placeholder="Palka"></td>
    <td><input type="number" step="0.01" oninput="hitungSemua()"></td>
    <td><input type="number" oninput="hitungSemua()"></td>
    <td><input type="number" oninput="hitungSemua()"></td>
    <td><input type="number" oninput="hitungSemua()"></td>
    <td><input type="number" step="0.0001" oninput="hitungSemua()" placeholder="auto"></td>
    <td class="tonase"></td>
    <td class="tonaseBJ"></td>
    <td><button onclick="hapusBaris(this)">❌</button></td>
  `;
  tbody.appendChild(row);
}

// ===== Hapus Baris =====
function hapusBaris(btn) {
  btn.closest("tr").remove();
  hitungSemua();
}

// ===== Hitung Semua Baris =====
function hitungSemua() {
  const rows = document.querySelectorAll("#tableBody tr");
  let totalSF = 0;

  rows.forEach(row => {
    const inputs = row.querySelectorAll("input");
    const [palka, soundingEl, v1El, v2El, suhuEl, bjEl] = inputs;
    const tonaseCell = row.querySelector(".tonase");
    const tonaseBJCell = row.querySelector(".tonaseBJ");

    const sounding = parseFloat(soundingEl.value);
    const v1 = parseFloat(v1El.value);
    const v2 = parseFloat(v2El.value);
    const suhu = parseFloat(suhuEl.value);
    let bj = parseFloat(bjEl.value);

    // Auto-isi BJ jika kosong
    if (isNaN(bj) && !isNaN(suhu)) {
      const suhuInt = Math.floor(suhu);
      bj = densitas[suhuInt] ?? 0;
      bjEl.value = bj ? bj.toFixed(4) : "";
    }

    if (!isNaN(sounding) && !isNaN(v1) && !isNaN(v2) && bj) {
      const tonase = Math.round(v1 + (v2 - v1) * (sounding - Math.floor(sounding)));
      const tonaseBJ = Math.round(tonase * bj);
      tonaseCell.textContent = tonase.toLocaleString();
      tonaseBJCell.textContent = tonaseBJ.toLocaleString();
      totalSF += tonaseBJ;
    } else {
      tonaseCell.textContent = "";
      tonaseBJCell.textContent = "";
    }
  });

  document.getElementById("totalSF").textContent = totalSF.toLocaleString();
  hitungDiff();
}

// ===== Hitung Diff dan %Diff =====
function hitungDiff() {
  const totalSF = parseFloat(document.getElementById("totalSF").textContent.replace(/,/g, "")) || 0;
  const bl = parseFloat(document.getElementById("blInput").value) || 0;
  const diff = totalSF - bl;
  const percent = bl ? (diff / bl * 100).toFixed(2) : 0;
  document.getElementById("diff").textContent = diff.toLocaleString();
  document.getElementById("percentDiff").textContent = percent;
}

// Tambah 1 baris awal otomatis
tambahBaris();
</script>

</body>
</html>
